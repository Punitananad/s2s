{% extends "base.html" %}
{% load static %}

{% block title %}Request #{{ req.id }} – Room {{ room.number }}{% endblock %}

{% block content %}
<div class="container py-3">

  <div class="d-flex justify-content-between align-items-center mb-2">
    <div>
      <h4 class="mb-1">Request #{{ req.id }}</h4>
      <div class="text-muted small">
        {{ hotel.name }} · Room {{ room.number }}
      </div>
    </div>

    <!-- Refresh status button -->
    <button type="button"
            class="btn btn-outline-primary btn-sm"
            onclick="window.location.reload();">
      Refresh status
    </button>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
          <div class="fw-semibold">
            {% if req.kind == "FOOD" %}
              Food Request
            {% else %}
              Service Request
            {% endif %}
          </div>
          <div class="small text-muted">
            Created: {{ req.created_at|date:"d M Y, H:i" }}
          </div>
        </div>

        <span class="badge
          {% if req.status == "NEW" %}bg-warning text-dark
          {% elif req.status == "ACCEPTED" %}bg-primary
          {% elif req.status == "COMPLETED" %}bg-success
          {% else %}bg-secondary{% endif %}">
          {{ req.get_status_display }}
        </span>
      </div>

      {% if req.note %}
        <p class="small mb-2">
          <strong>Note:</strong> {{ req.note }}
        </p>
      {% endif %}

      {% if req.kind == "FOOD" %}
        <h6 class="mt-3 mb-2">Items</h6>
        <ul class="list-group mb-2">
          {% for line in req.lines.all %}
            <li class="list-group-item d-flex justify-content-between">
              <span>{{ line.name_snapshot }} × {{ line.qty }}</span>
              <span>₹ {{ line.price_snapshot }}</span>
            </li>
          {% empty %}
            <li class="list-group-item text-muted small">
              No items on this request.
            </li>
          {% endfor %}
        </ul>
        <div class="text-end fw-semibold">
          Total: ₹ {{ req.subtotal }}
        </div>
      {% else %}
        {% if req.service_item %}
          <div class="mt-2">
            <strong>Service:</strong> {{ req.service_item.name }}
          </div>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <p class="small text-muted mb-0">
    This page shows the latest status of this request.
    Tap the <strong>Refresh status</strong> button above to see updates
    when the hotel team changes the status.
  </p>
</div>
{% endblock %}
